from discord.ext.commands import Bot
import os
import discord
# from db import Database
import keep_alive
import DiscordUtils
from dotenv import load_dotenv
from discord_components import *

load_dotenv()
intents = discord.Intents.all()
intents.members = True
bot = Bot(command_prefix="?", case_insensitive=True, intents=intents)
bot.remove_command("help")
global music
music = DiscordUtils.Music()
DiscordComponents(bot)


@bot.event
async def on_ready():
    await bot.change_presence(status=discord.Status.idle, activity=discord.Game('?help'))
    print(f"Logged in as {bot.user}")
    # db = Database("main.db")
    # await db.autoexecute("CREATE TABLE IF NOT EXISTS giveaway(GuildID	INTEGER,ChannelID	INTEGER,MessageID	INTEGER,Prize	TEXT,EndTime	TEXT, GiveawayID	INTEGER);")

if __name__ == "__main__":
    try:
        for filename in os.listdir('./cogs'):
            if(filename.endswith('.py')):
                bot.load_extension(f'cogs.{filename[:-3]}')
    except Exception as exc:
        print(exc)


keep_alive.keep_alive()
# token = os.environ.get("TOKEN") # in replit
token = os.getenv("TOKEN")

bot.run(token)
